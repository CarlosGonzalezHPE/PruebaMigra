

[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize]


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/PoolService]

ClassName=com.hp.usage.jdbc.poolservice.JDBCConnectionPoolService
ConnectionPools=DEG_DSN_TT_SIGNUP_Pool


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/PoolService/CommonConnectionPolicies]

ClassName=com.hp.usage.jdbc.poolservice.client.ConnectionPolicies
Policies=Policy1


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/PoolService/CommonConnectionPolicies/Policy1]

ClassName=com.hp.usage.jdbc.poolservice.client.SimpleConnectionPolicy
Pools=DEG_DSN_TT_SIGNUP_Pool


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/PoolService/DEG_DSN_TT_SIGNUP_Pool]

ClassName=com.hp.usage.jdbc.poolservice.pool.JDBCConnectionPool
ConnectionTestQuery=select 1 from dual
Database=${DEG_CLIENT_STRING_CONNECTION}
DatabaseClass=${JDBC_CLIENT_DRIVER}
InitialPoolSize=100
MaxPoolSize=200
MinPoolSize=100
Password=${PASSWD_DEG_DSN}
RetryCount=1
RetryInterval=300
User=${USER_DEG_DSN}


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/ReferenceDataService]

QueryNames=DEG_DEVICE_ICCIDS_LOOKUP


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/ReferenceDataService/DEG_DEVICE_ICCIDS_LOOKUP]

ClassName=JDBCQuery
CommonPolicyID=Policy1
FieldExtracted=DEG_eICCID,DEG_eICCID,-
FieldExtracted=DEG_M_STATUS,DEG_M_STATUS,-
QueryString=select %FIELDS from DEG_DEVICE_ICCIDS where DEG_IMSI = %DEG_IMSI


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/ReferenceDataService/DEG_DEVICE_ICCIDS_LOOKUP/ErrorRule]

ClassName=com.hp.siu.collector.rules.RuleChain
RuleNames=100.LogAlarming


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/ReferenceDataService/DEG_DEVICE_ICCIDS_LOOKUP/ErrorRule/100.LogAlarming]

Attributes=log_DB_Operation
Attributes=log_Table_Name
ClassName=com.hp.siu.collector.rules.LogNMERule
LogLevel=CRITICAL
Message=Database Error:
PropertyName=LogRequestIssueLevel1
UseProperty=true


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/ReferenceDataService/DEG_DEVICE_ICCIDS_LOOKUP/FinalRule]

#AdornOps=substr 0 length-1 DEG_Tmp1String DEG_Tmp2String
AdornOps=replace "[," "[" DEG_Tmp1String DEG_Tmp1String
AdornOps=+ DEG_Tmp1String ] DEG_Tmp1String
AdornOps=copy DEG_Tmp1String DEG_Tmp2String
ClassName=com.hp.siu.collector.rules.AdornmentRule


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/ReferenceDataService/DEG_DEVICE_ICCIDS_LOOKUP/InitialRule]

AdornOps=set log_DB_Operation "QUERY"
AdornOps=set log_Table_Name "DEG_DEVICE_ICCIDS"
AdornOps=set DEG_Tmp1String "["
ClassName=com.hp.siu.collector.rules.AdornmentRule


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/ReferenceDataService/DEG_DEVICE_ICCIDS_LOOKUP/ResultRowRule]

ClassName=com.hp.siu.collector.rules.ConditionalRule
Conditions=DEG_eICCID,!=,"-"
Conditions=DEG_M_STATUS,!=,"-"
Operations=and
TrueRuleChain=100.BuildICCIDandSTATUS


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/ReferenceDataService/DEG_DEVICE_ICCIDS_LOOKUP/ResultRowRule/100.BuildICCIDandSTATUS]

#<iccid1>:<status1>[;<iccid2>:<status2>[...;<iccidN>:<statusN>
AdornOps=+ DEG_Tmp1String ,{"ICCID" DEG_Tmp1String
AdornOps=+ DEG_Tmp1String :" DEG_Tmp1String
AdornOps=+ DEG_Tmp1String DEG_eICCID DEG_Tmp1String
AdornOps=+ DEG_Tmp1String ","STATUS" DEG_Tmp1String
AdornOps=+ DEG_Tmp1String :" DEG_Tmp1String
AdornOps=+ DEG_Tmp1String DEG_M_STATUS DEG_Tmp1String
AdornOps=+ DEG_Tmp1String "} DEG_Tmp1String
ClassName=com.hp.siu.collector.rules.AdornmentRule


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains]

##___ Database Operations Rulechain ___##########
RuleChainNames=000.SessionStoreDefaultErrorRuleChain
RuleChainNames=001.SessionStoreKeyNotExistsRuleChain
RuleChainNames=002.SessionStoreDuplicateKeyRuleChain
##___ Custom Operations Rulechain ___##########
RuleChainNames=CUSTRC_Apple_SU_signUpForSIMServiceCustom


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/000.SessionStoreDefaultErrorRuleChain]

ClassName=com.hp.siu.collector.rules.RuleChain
RuleNames=100.SetLookupErrorFlag
RuleNames=150.SetErrorInfo
RuleNames=200.LogAlarming


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/000.SessionStoreDefaultErrorRuleChain/100.SetLookupErrorFlag]

AdornOps=set DEG_CDevSessionStoreErrorFlagInteger 1
ClassName=com.hp.siu.collector.rules.AdornmentRule


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/000.SessionStoreDefaultErrorRuleChain/150.SetErrorInfo]

AdornOps=set CUST_SUSS_OUT_TemplateInvocationStatus 1
ClassName=com.hp.siu.collector.rules.AdornmentRule


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/000.SessionStoreDefaultErrorRuleChain/200.LogAlarming]

Attributes=log_DB_Operation
Attributes=log_Table_Name
ClassName=com.hp.siu.collector.rules.LogNMERule
LogLevel=CRITICAL
Message=Database Error:
PropertyName=LogRequestIssueLevel1
UseProperty=true


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/001.SessionStoreKeyNotExistsRuleChain]

ClassName=com.hp.siu.collector.rules.RuleChain
RuleNames=100.ClearDuplicateKeyFlag


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/001.SessionStoreKeyNotExistsRuleChain/100.ClearDuplicateKeyFlag]

AdornOps=set DEG_CDevSessionStoreKeyExistsFlagInteger 0
ClassName=com.hp.siu.collector.rules.AdornmentRule


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/002.SessionStoreDuplicateKeyRuleChain]

ClassName=com.hp.siu.collector.rules.RuleChain
RuleNames=100.SetDuplicateKeyFlag


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/002.SessionStoreDuplicateKeyRuleChain/100.SetDuplicateKeyFlag]

AdornOps=set DEG_CDevSessionStoreKeyExistsFlagInteger 1
ClassName=com.hp.siu.collector.rules.AdornmentRule


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom]

ClassName=com.hp.siu.collector.rules.RuleChain
RuleNames=050.EventReceived
RuleNames=100.LogNMERule
RuleNames=110.InitValues
#RuleNames=120.ManipulateResponseNME
RuleNames=200.CreateSessionDeviceIccids
RuleNames=300.CreateSignupUrlPostData
RuleNames=400.ResponeToSignUpForSIMServiceCore


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/050.EventReceived]

ClassName=FormattedPrintRule
FormatString=Received signUpForSIMService Request with IMSI (%s), EID (%s), ICCID (%s), IMEI (%s), MEID (%s), DEVICE_TYPE (%s)
InputFields=CUST_SUSS_IN_IMSIString
InputFields=CUST_SUSS_IN_EIDString
InputFields=CUST_SUSS_IN_primary_iccid_string
InputFields=CUST_SUSS_IN_SECONDARY_DEVICE_IMEIString
InputFields=CUST_SUSS_IN_SECONDARY_DEVICE_MEIDString
InputFields=CUST_SUSS_IN_SECONDARY_DEVICE_TypeString
LogMessage=true
ResultField=DEG_Tmp1String


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/100.LogNMERule]

Attributes=CUST_SUSS_IN_primary_iccid_string
Attributes=CUST_SUSS_IN_MDNString
Attributes=CUST_SUSS_IN_IMSIString
Attributes=CUST_SUSS_IN_EIDString
Attributes=CUST_SUSS_IN_planidString
Attributes=CUST_SUSS_IN_plandescString
Attributes=CUST_SUSS_IN_SECONDARY_DEVICE_ICCIDSList
Attributes=CUST_SUSS_IN_SECONDARY_DEVICE_IMEIString
Attributes=CUST_SUSS_IN_SECONDARY_DEVICE_MEIDString
Attributes=CUST_SUSS_IN_SECONDARY_DEVICE_TypeString
Attributes=CUST_SUSS_OUT_TemplateInvocationStatus
Attributes=CUST_SUSS_OUT_SIGNUP_URL
Attributes=CUST_SUSS_OUT_SIGNUP_URL_POSTDATA
Attributes=CUST_SUSS_OUT_JSON_Response_Code_String
ClassName=com.hp.siu.collector.rules.LogNMERule
LogLevel=DEBUG
Message=Log from the CUSTRC_Apple_SU_signUpForSIMServiceCustom template
NullAlso=true


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/110.InitValues]

AdornOps=set CUST_SUSS_OUT_planidString ""
AdornOps=set CUST_SUSS_OUT_plandescString ""
AdornOps=set DEG_Tmp1String ""
AdornOps=set CUST_SUSS_OUT_TemplateInvocationStatus 0
AdornOps=set CUST_SUSS_OUT_JSON_Response_Code_String "6000"
ClassName=com.hp.siu.collector.rules.AdornmentRule


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/120.ManipulateResponseNME]

ClassName=com.hp.siu.collector.rules.SwitchConditionRule
Conditions=CUST_SUSS_OUT_planidString,!=,""
Conditions=CUST_SUSS_OUT_plandescString,!=,""
Operations=DoAll
setplandescString=900.setplandescString
setplanidString=850.setplanidString
TrueRuleChain=setplanidString
TrueRuleChain=setplandescString


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/120.ManipulateResponseNME/850.setplanidString]

AdornOps=+ CUST_SUSS_OUT_SIGNUP_URL_POSTDATA & CUST_SUSS_OUT_SIGNUP_URL_POSTDATA
AdornOps=+ CUST_SUSS_OUT_SIGNUP_URL_POSTDATA plan_id= CUST_SUSS_OUT_SIGNUP_URL_POSTDATA
AdornOps=+ CUST_SUSS_OUT_SIGNUP_URL_POSTDATA CUST_SUSS_OUT_planidString CUST_SUSS_OUT_SIGNUP_URL_POSTDATA
ClassName=com.hp.siu.collector.rules.AdornmentRule


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/120.ManipulateResponseNME/900.setplandescString]

AdornOps=+ CUST_SUSS_OUT_SIGNUP_URL_POSTDATA & CUST_SUSS_OUT_SIGNUP_URL_POSTDATA
AdornOps=+ CUST_SUSS_OUT_SIGNUP_URL_POSTDATA plan_desc= CUST_SUSS_OUT_SIGNUP_URL_POSTDATA
AdornOps=+ CUST_SUSS_OUT_SIGNUP_URL_POSTDATA CUST_SUSS_OUT_plandescString CUST_SUSS_OUT_SIGNUP_URL_POSTDATA
ClassName=com.hp.siu.collector.rules.AdornmentRule


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/200.CreateSessionDeviceIccids]

ClassName=com.hp.siu.collector.rules.RuleChain
RuleNames=100.InitCreate
#RuleNames=150.GetFirstSecondaryICCID
RuleNames=200.CreateSessionToDB
RuleNames=300.CheckCreateStatus


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/200.CreateSessionDeviceIccids/100.InitCreate]

AdornOps=set DEG_CDevSessionStoreErrorFlagInteger 0
AdornOps=set DEG_CDevSessionStoreKeyExistsFlagInteger 0
AdornOps=set DEG_Tmp1Integer 0
AdornOps=copy CUST_SUSS_IN_IMSIString DEG_IMSI
AdornOps=copy CUST_SUSS_IN_EIDString DEG_EID
ClassName=com.hp.siu.collector.rules.AdornmentRule


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/200.CreateSessionDeviceIccids/150.GetFirstSecondaryICCID]

ClassName=ListAttributeIterator
ListAttributeName=CUST_SUSS_IN_SECONDARY_DEVICE_ICCIDSList
RuleChain=100.CountElements
RuleChain=200.TakeOnlyOneSecondaryIccid
TmpAttributeName=DEG_Tmp1String


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/200.CreateSessionDeviceIccids/150.GetFirstSecondaryICCID/100.CountElements]

AdornOps=+ DEG_OEMDevArrayIndexInteger 1 DEG_OEMDevArrayIndexInteger
ClassName=AdornmentRule


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/200.CreateSessionDeviceIccids/150.GetFirstSecondaryICCID/200.TakeOnlyOneSecondaryIccid]

ClassName=com.hp.siu.collector.rules.ConditionalRule
Conditions=DEG_OEMDevArrayIndexInteger,=,1
TrueRuleChain=100.TakeFirstElement


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/200.CreateSessionDeviceIccids/150.GetFirstSecondaryICCID/200.TakeOnlyOneSecondaryIccid/100.TakeFirstElement]

AdornOps=copy DEG_Tmp1String DEG_eICCID
ClassName=AdornmentRule


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/200.CreateSessionDeviceIccids/200.CreateSessionToDB]

ClassName=com.hp.siu.collector.rules.RuleChain
RuleNames=100.CheckIfExist
RuleNames=200.InsertUpdateSession


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/200.CreateSessionDeviceIccids/200.CreateSessionToDB/100.CheckIfExist]

ClassName=com.hp.siu.sessionserver.rules.QuerySessionsRule
ContinueAfterErrorFixed=true
CountAttribute=DEG_Tmp1Integer
DefaultErrorRuleChain=000.SessionStoreDefaultErrorRuleChain
QueryConditions=DEG_IMSI,=,%DEG_IMSI
QueryConditions=DEG_EID,=,%DEG_EID 
SessionStore=DEG_DEVICE_ICCIDS_SessionStore


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/200.CreateSessionDeviceIccids/200.CreateSessionToDB/200.InsertUpdateSession]

ClassName=com.hp.siu.collector.rules.ConditionalRule
Conditions=DEG_Tmp1Integer,=,0
FalseRuleChain=200.SetValuesUpdateSession
FalseRuleChain=200.SetValuesUpdateSession.Log
FalseRuleChain=210.UpdateSession
TrueRuleChain=100.SetValuesInsertSession
TrueRuleChain=100.SetValuesInsertSession.Log
TrueRuleChain=110.InsertSession


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/200.CreateSessionDeviceIccids/200.CreateSessionToDB/200.InsertUpdateSession/100.SetValuesInsertSession]

AdornOps=copy CUST_SUSS_IN_IMSIString DEG_IMSI
AdornOps=copy CUST_SUSS_IN_primary_iccid_string DEG_ICCID
AdornOps=copy CUST_SUSS_IN_EIDString DEG_EID
AdornOps=copy CUST_SUSS_IN_SECONDARY_DEVICE_IMEIString DEG_eIMEI
AdornOps=copy CUST_SUSS_IN_SECONDARY_DEVICE_MEIDString DEG_eMEID
AdornOps=copy CUST_SUSS_IN_SECONDARY_DEVICE_TypeString DEG_eDEVICE_TYPE
AdornOps=set DEG_M_STATUS "New"
AdornOps=setsystime DEG_MS_SIGNUP_STARTTIME
AdornOps=setsystime DEG_LASTUPDATE
ClassName=com.hp.siu.collector.rules.AdornmentRule


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/200.CreateSessionDeviceIccids/200.CreateSessionToDB/200.InsertUpdateSession/100.SetValuesInsertSession.Log]

Attributes=DEG_IMSI
Attributes=DEG_ICCID
Attributes=DEG_EID
Attributes=DEG_eMEID
Attributes=DEG_eIMEI
Attributes=DEG_eDEVICE_TYPE
Attributes=DEG_M_STATUS
Attributes=DEG_MS_SIGNUP_STARTTIME
Attributes=DEG_LASTUPDATE
ClassName=com.hp.siu.collector.rules.LogNMERule
LogLevel=DEBUG
Message=200.InsertUpdateSession/100.SetValuesInsertSession.Log: 
NullAlso=true


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/200.CreateSessionDeviceIccids/200.CreateSessionToDB/200.InsertUpdateSession/110.InsertSession]

AutoCommit=true
ClassName=JDBCUpdateRule
ConnectionPoolID=DEG_DSN_TT_SIGNUP_Pool
NullValues=DEG_eMEID,""
NullValues=DEG_eIMEI,""
NullValues=DEG_eDEVICE_TYPE,""
RetryTimeout=3
SQLStatement=INSERT INTO DEG_DEVICE_ICCIDS (DEG_IMSI,DEG_ICCID,DEG_EID,DEG_eMEID,DEG_eIMEI,DEG_eDEVICE_TYPE,DEG_M_STATUS,DEG_MS_SIGNUP_STARTTIME,DEG_LASTUPDATE) VALUES (%DEG_IMSI,%DEG_ICCID,%DEG_EID,%DEG_eMEID,%DEG_eIMEI,%DEG_eDEVICE_TYPE,%DEG_M_STATUS,%DEG_MS_SIGNUP_STARTTIME,%DEG_LASTUPDATE)


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/200.CreateSessionDeviceIccids/200.CreateSessionToDB/200.InsertUpdateSession/110.InsertSession/ErrorRule]

ClassName=RuleChain
RuleNames=100.SetErrorDatabase
RuleNames=200.ErrorLog


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/200.CreateSessionDeviceIccids/200.CreateSessionToDB/200.InsertUpdateSession/110.InsertSession/ErrorRule/100.SetErrorDatabase]

AdornOps=set DEG_CDevSessionStoreErrorFlagInteger 1
AdornOps=set CUST_SUSS_OUT_TemplateInvocationStatus 1
AdornOps=set CUST_SUSS_OUT_JSON_Response_Code_String "6005"
ClassName=com.hp.siu.collector.rules.AdornmentRule


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/200.CreateSessionDeviceIccids/200.CreateSessionToDB/200.InsertUpdateSession/110.InsertSession/ErrorRule/200.ErrorLog]

Attributes=DEG_IMSI
Attributes=DEG_ICCID
Attributes=DEG_EID
Attributes=DEG_eMEID
Attributes=DEG_eIMEI
Attributes=DEG_eDEVICE_TYPE
Attributes=DEG_M_STATUS
Attributes=CUST_SUSS_OUT_JSON_Response_Code_String
ClassName=com.hp.siu.collector.rules.LogNMERule
LogLevel=CRITICAL
Message=Database Error: Unable to Update entry in DEG_DEVICE_ICCIDS session store. 
NullAlso=true
PropertyName=LogRequestIssueLevel1
UseProperty=true


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/200.CreateSessionDeviceIccids/200.CreateSessionToDB/200.InsertUpdateSession/200.SetValuesUpdateSession]

AdornOps=copy CUST_SUSS_IN_IMSIString DEG_IMSI
AdornOps=copy CUST_SUSS_IN_EIDString DEG_EID
AdornOps=set DEG_M_STATUS "Reset"
AdornOps=setsystime DEG_LASTUPDATE
ClassName=com.hp.siu.collector.rules.AdornmentRule


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/200.CreateSessionDeviceIccids/200.CreateSessionToDB/200.InsertUpdateSession/200.SetValuesUpdateSession.Log]

Attributes=DEG_IMSI
Attributes=DEG_EID
Attributes=DEG_M_STATUS
Attributes=DEG_LASTUPDATE
ClassName=com.hp.siu.collector.rules.LogNMERule
LogLevel=DEBUG
Message=200.InsertUpdateSession/200.SetValuesUpdateSession.Log: 
NullAlso=true


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/200.CreateSessionDeviceIccids/200.CreateSessionToDB/200.InsertUpdateSession/210.UpdateSession]

AutoCommit=true
ClassName=JDBCUpdateRule
ConnectionPoolID=DEG_DSN_TT_SIGNUP_Pool
RetryTimeout=3
SQLStatement=UPDATE DEG_DEVICE_ICCIDS SET DEG_eIMSI = NULL, DEG_eICCID = NULL, DEG_M_STATUS = %DEG_M_STATUS, DEG_LASTUPDATE = %DEG_LASTUPDATE  WHERE DEG_IMSI = %DEG_IMSI AND DEG_EID = %DEG_EID


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/200.CreateSessionDeviceIccids/200.CreateSessionToDB/200.InsertUpdateSession/210.UpdateSession/ErrorRule]

ClassName=RuleChain
RuleNames=100.SetErrorDatabase
RuleNames=200.ErrorLog


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/200.CreateSessionDeviceIccids/200.CreateSessionToDB/200.InsertUpdateSession/210.UpdateSession/ErrorRule/100.SetErrorDatabase]

AdornOps=set DEG_CDevSessionStoreErrorFlagInteger 1
AdornOps=set CUST_SUSS_OUT_TemplateInvocationStatus 1
AdornOps=set CUST_SUSS_OUT_JSON_Response_Code_String "6005"
ClassName=com.hp.siu.collector.rules.AdornmentRule


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/200.CreateSessionDeviceIccids/200.CreateSessionToDB/200.InsertUpdateSession/210.UpdateSession/ErrorRule/200.ErrorLog]

Attributes=DEG_IMSI
Attributes=DEG_ICCID
Attributes=DEG_EID
Attributes=DEG_eMEID
Attributes=DEG_eIMEI
Attributes=DEG_eDEVICE_TYPE
Attributes=DEG_M_STATUS
Attributes=CUST_SUSS_OUT_JSON_Response_Code_String
ClassName=com.hp.siu.collector.rules.LogNMERule
LogLevel=CRITICAL
Message=Database Error: Unable to Update entry in DEG_DEVICE_ICCIDS session store. 
NullAlso=true
PropertyName=LogRequestIssueLevel1
UseProperty=true


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/200.CreateSessionDeviceIccids/300.CheckCreateStatus]

ClassName=com.hp.siu.collector.rules.ConditionalRule
Conditions=DEG_CDevSessionStoreErrorFlagInteger,=,0
TrueRuleChain=100.CreateSessionLogNMERule


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/200.CreateSessionDeviceIccids/300.CheckCreateStatus/100.CreateSessionLogNMERule]

Attributes=DEG_IMSI
Attributes=DEG_ICCID
Attributes=DEG_EID
Attributes=DEG_eMEID
Attributes=DEG_eIMEI
Attributes=DEG_eDEVICE_TYPE
Attributes=DEG_M_STATUS
ClassName=com.hp.siu.collector.rules.LogNMERule
LogLevel=INFO
Message=Database: Insert/Update entry in DEG_DEVICE_ICCIDS session store. 
NullAlso=true
PropertyName=LogRequestIssueLevel1
UseProperty=true


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/300.CreateSignupUrlPostData]
#IMSI=<imsi>&MDN=<msisdn>[&STATUS=<iccid1>:<status1>[;<iccid2>:<status2>[...;<iccidN>:<statusN>]]
ClassName=com.hp.siu.collector.rules.ConditionalRule
Conditions=DEG_CDevSessionStoreErrorFlagInteger,=,0
TrueRuleChain=100.setIMSIToPostData
TrueRuleChain=200.setMDNToPostData
TrueRuleChain=300.QueryIccidAndStatusByIMSI
TrueRuleChain=400.CopyPrimaryInfoAndSecondaryInfo


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/300.CreateSignupUrlPostData/100.setIMSIToPostData]

AdornOps=set CUST_SUSS_OUT_SIGNUP_URL_POSTDATA "{"
AdornOps=set DEG_AccountUrlPostDataTempString " : "
AdornOps=+ CUST_SUSS_OUT_SIGNUP_URL_POSTDATA "IMSI" CUST_SUSS_OUT_SIGNUP_URL_POSTDATA
AdornOps=+ CUST_SUSS_OUT_SIGNUP_URL_POSTDATA DEG_AccountUrlPostDataTempString CUST_SUSS_OUT_SIGNUP_URL_POSTDATA
AdornOps=+ CUST_SUSS_OUT_SIGNUP_URL_POSTDATA " CUST_SUSS_OUT_SIGNUP_URL_POSTDATA
AdornOps=+ CUST_SUSS_OUT_SIGNUP_URL_POSTDATA CUST_SUSS_IN_IMSIString CUST_SUSS_OUT_SIGNUP_URL_POSTDATA
AdornOps=+ CUST_SUSS_OUT_SIGNUP_URL_POSTDATA " CUST_SUSS_OUT_SIGNUP_URL_POSTDATA
ClassName=com.hp.siu.collector.rules.AdornmentRule


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/300.CreateSignupUrlPostData/200.setMDNToPostData]

AdornOps=+ CUST_SUSS_OUT_SIGNUP_URL_POSTDATA ,"MSISDN" CUST_SUSS_OUT_SIGNUP_URL_POSTDATA
AdornOps=+ CUST_SUSS_OUT_SIGNUP_URL_POSTDATA DEG_AccountUrlPostDataTempString CUST_SUSS_OUT_SIGNUP_URL_POSTDATA
AdornOps=+ CUST_SUSS_OUT_SIGNUP_URL_POSTDATA " CUST_SUSS_OUT_SIGNUP_URL_POSTDATA
AdornOps=+ CUST_SUSS_OUT_SIGNUP_URL_POSTDATA CUST_SUSS_IN_MDNString CUST_SUSS_OUT_SIGNUP_URL_POSTDATA
AdornOps=+ CUST_SUSS_OUT_SIGNUP_URL_POSTDATA " CUST_SUSS_OUT_SIGNUP_URL_POSTDATA
ClassName=com.hp.siu.collector.rules.AdornmentRule


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/300.CreateSignupUrlPostData/300.QueryIccidAndStatusByIMSI]

ClassName=com.hp.siu.collector.rules.RuleChain
RuleNames=100.InitLookup
RuleNames=200.ExecuteLookup


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/300.CreateSignupUrlPostData/300.QueryIccidAndStatusByIMSI/100.InitLookup]

AdornOps=set log_Table_Name "DEG_DEVICE_ICCIDS"
AdornOps=set log_DB_Operation "SELECT"
ClassName=com.hp.siu.collector.rules.AdornmentRule


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/300.CreateSignupUrlPostData/300.QueryIccidAndStatusByIMSI/200.ExecuteLookup]

ClassName=com.hp.usage.refdatasrv.RefDataLookupRule
QueryName=DEG_DEVICE_ICCIDS_LOOKUP


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/300.CreateSignupUrlPostData/400.CopyPrimaryInfoAndSecondaryInfo]

ClassName=com.hp.siu.collector.rules.ConditionalRule
Conditions=DEG_Tmp2String,!=,""
TrueRuleChain=100.ConcatenateSecondaryInfo


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/300.CreateSignupUrlPostData/400.CopyPrimaryInfoAndSecondaryInfo/100.ConcatenateSecondaryInfo]
#AdornOps=+ CUST_SUSS_OUT_SIGNUP_URL_POSTDATA &STATUS= CUST_SUSS_OUT_SIGNUP_URL_POSTDATA
AdornOps=+ CUST_SUSS_OUT_SIGNUP_URL_POSTDATA ,"ICCIDS" CUST_SUSS_OUT_SIGNUP_URL_POSTDATA
AdornOps=+ CUST_SUSS_OUT_SIGNUP_URL_POSTDATA : CUST_SUSS_OUT_SIGNUP_URL_POSTDATA
AdornOps=+ CUST_SUSS_OUT_SIGNUP_URL_POSTDATA DEG_Tmp2String CUST_SUSS_OUT_SIGNUP_URL_POSTDATA
ClassName=com.hp.siu.collector.rules.AdornmentRule


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/400.ResponeToSignUpForSIMServiceCore]

ClassName=com.hp.siu.collector.rules.ConditionalRule
Conditions=CUST_SUSS_OUT_TemplateInvocationStatus,=,0
FalseRuleChain=200.LoggerFailure
TrueRuleChain=100.LoggerSuccess


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/400.ResponeToSignUpForSIMServiceCore/100.LoggerSuccess]

ClassName=FormattedPrintRule
FormatString=Successfully SignUpForSIMService Response with IMSI (%s), EID (%s), STATUS (%s), SIGNUP_URL (%s), SIGNUP_URL_POSTDATA(%s), RESPONSE (%s)
InputFields=DEG_IMSI
InputFields=DEG_EID
InputFields=DEG_M_STATUS
InputFields=CUST_SUSS_OUT_SIGNUP_URL
InputFields=CUST_SUSS_OUT_SIGNUP_URL_POSTDATA
InputFields=CUST_SUSS_OUT_JSON_Response_Code_String
LogMessage=true
ResultField=DEG_Tmp1String


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/RuleChains/CUSTRC_Apple_SU_signUpForSIMServiceCustom/400.ResponeToSignUpForSIMServiceCore/200.LoggerFailure]

ClassName=FormattedPrintRule
FormatString=Failure SignUpForSIMService Response with IMSI (%s), EID (%s), RESPONSE (%s)
InputFields=DEG_IMSI
InputFields=DEG_EID
InputFields=CUST_SUSS_OUT_JSON_Response_Code_String
LogMessage=true
ResultField=DEG_Tmp1String


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/SessionStores]

ClassName=com.hp.siu.sessionserver.SessionStoreManager
SessionStoreNames=DEG_DEVICE_ICCIDS_SessionStore


[/templates/DEG/DeviceInterface/signUpForSIMServiceCustom_V2Customize/SessionStores/DEG_DEVICE_ICCIDS_SessionStore]

Attributes=DEG_IMSI,key
Attributes=DEG_ICCID
Attributes=DEG_EID,key
Attributes=DEG_eIMSI
Attributes=DEG_eICCID
Attributes=DEG_eIMEI
Attributes=DEG_eMEID
Attributes=DEG_eDEVICE_TYPE
Attributes=DEG_M_STATUS
Attributes=DEG_MS_SIGNUP_STARTTIME
Attributes=DEG_LASTUPDATE
ClassName=com.hp.siu.sessionserver.JDBCSessionStore
CommonPolicyID=Policy1
DatabaseId=DEG_DEVICE_ICCIDS
MaxDatabaseConnections=20
SQLTypeMap=DEG_IMSI,VARCHAR(64)
SQLTypeMap=DEG_ICCID,VARCHAR(32)
SQLTypeMap=DEG_EID,VARCHAR(128)
SQLTypeMap=DEG_eIMSI,VARCHAR(64)
SQLTypeMap=DEG_eICCID,VARCHAR(64)
SQLTypeMap=DEG_eIMEI,VARCHAR(64)
SQLTypeMap=DEG_eMEID,VARCHAR(128)
SQLTypeMap=DEG_eDEVICE_TYPE,VARCHAR(32)
SQLTypeMap=DEG_M_STATUS,VARCHAR(64)
SQLTypeMap=DEG_MS_SIGNUP_STARTTIME,DATE
SQLTypeMap=DEG_LASTUPDATE,DATE
